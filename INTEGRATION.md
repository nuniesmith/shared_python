# Integration Guide

This document provides guidelines for integrating the system with other components.

## Prerequisites

Before integration, ensure that the following prerequisites are met:
- Component A is installed.
- Component B is configured.

## Steps for Integration

1. Start by configuring Component A.
2. Connect Component B to the system.
3. Verify the integration by running the tests.

## Troubleshooting

If you encounter issues, refer to the troubleshooting section of the documentation.

## Conclusion

Following these guidelines will help ensure a smooth integration process.

## Shared Python Integration Guide

This document summarizes how FKS services consume the shared Python package `shared_python` for
configuration, logging, exceptions, types, and utilities.

## Package Layout

```text
shared/shared_python/
  pyproject.toml
  src/
    __init__.py  # re-exports core helpers
    config.py
    exceptions.py
    logging.py
    types.py
    utils.py
    py.typed      # enables type checker discovery
```

## Adding to a Service (Path Dependency)

For Poetry-managed services (pyproject under service root):

```toml
[tool.poetry.dependencies]
shared_python = { path = "../../shared/shared_python", develop = true }
```

For services with pyproject inside `src/` (e.g. api/training): adjust one more `..`:

```toml
shared_python = { path = "../../../shared/shared_python", develop = true }
```

For setuptools style:

```toml
[project]
dependencies = [
  "shared_python @ file://../../../shared/shared_python"
]
```

## Import Pattern

```python
from shared_python import load_config, get_settings, get_risk_threshold, RiskLimitExceeded
```

Only import what you use; avoid wildcard imports.

## Local Editable Installs

During development (Poetry):

```bash
poetry install
```

Plain pip (editable):

```bash
pip install -e ../../shared/shared_python
```

## Updating Shared Code

1. Modify or add module in `shared/shared_python/src`.
2. (Optional) Add / update tests in `shared/shared_python/src/tests`.
3. Run `pytest` in at least one dependent service.
4. Commit changes; editable path makes updates immediate.

## Type Checking

`py.typed` enables downstream type checkers (mypy/pyright) to consume exported types.

## Common Gotchas

- Wrong relative path depth causes `ModuleNotFoundError`. Verify with:

  ```bash
  python -c "import shared_python; print(shared_python)"
  ```

- Docker: Ensure Dockerfile `COPY` includes `shared/shared_python/` before install.
- Build cache: Path dependency changes may require invalidating cached layers.

## Future Extensions

- Autogenerated models from JSON schemas (typesync) surfaced via `types.py`.
- Structured logging initializer (e.g. `init_logging()` helper).
- Cross-language error code normalization (C#/Rust mirrors).

## Minimal Validation Test Template

```python
def test_shared_import():
    from shared_python import load_config
    assert load_config is not None
```

---

Maintainers: Update this guide when adding new cross-service primitives.
Maintainers: Update this guide when adding new cross-service primitives.
